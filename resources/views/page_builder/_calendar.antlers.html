{{#
    @name Calendar
    @desc The Calendar page builder block.
    @set page.page_builder.calendar
#}}

{{ partial:page_builder/block }}
    <div class="grid grid-cols-12 gap-6 px-2 pt-30 pb-10 sm:px-6 lg:px-12">
        <div
            id="calendar"
            class="col-span-12 sm:col-span-10 sm:col-start-2 lg:col-span-8 lg:col-start-3"
        ></div>
    </div>

    <!-- Modal -->
    <div
        x-data="{ open: false, event: {} }"
        x-init="window.addEventListener('calendar-event', e => { event = e.detail; open = true })"
        x-show="open"
        x-cloak
        class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
    >
        <div
            @click.outside="open = false"
            class="w-full max-w-md transform rounded-lg bg-white p-6 shadow-lg transition-all"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="scale-95 opacity-0"
            x-transition:enter-end="scale-100 opacity-100"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="scale-100 opacity-100"
            x-transition:leave-end="scale-95 opacity-0"
        >
            <!-- Header: Day and Date -->
            <div class="mb-2 flex items-start justify-between">
                <h2
                    class="text-sm font-medium text-gray-600"
                    x-text="formatDayDate(event.start)"
                ></h2>
                <button
                    @click="open = false"
                    class="text-2xl leading-none text-gray-400 hover:text-gray-800"
                >
                    &times;
                </button>
            </div>

            <!-- Title with dynamic color -->
            <h3
                class="text-lg font-semibold text-gray-800 uppercase"
                :style="event.extendedProps?.tagColor ? `color: ${event.extendedProps.tagColor}` : ''"
                x-text="event.title"
            ></h3>

            <hr class="my-3 border-gray-300" />

            <!-- Time -->
            <div class="flex items-center gap-2 text-sm text-gray-700">
                <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-4 w-4 text-gray-500"
                    viewBox="0 0 24 24"
                    fill="currentColor"
                >
                    <path
                        d="M12 8v5h4v-2h-2V8h-2Zm0-6a10 10 0 1 1 0 20 10 10 0 0 1 0-20Z"
                    />
                </svg>
                <span
                    x-text="event.allDay
            ? 'All Day'
            : (event.extendedProps?.start_time
                ? formatTime(event.extendedProps.start_time) +
                    (event.extendedProps.end_time
                        ? ' â€“ ' + formatTime(event.extendedProps.end_time)
                        : '')
                : '')"
                ></span>
            </div>
            <!-- Extra Details -->
            <div class="mt-4 space-y-2 text-sm text-gray-700">
                <template x-if="event.extendedProps?.speaker">
                    <p class="flex items-center gap-2">
                        <!-- Human Talking SVG -->
                        <svg
                            viewBox="0 0 64 64"
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 text-gray-500"
                            fill="currentColor"
                            aria-hidden="true"
                            role="img"
                        >
                            <path
                                d="M38.478 42.632c-4.644-1.466-3.322-2.633 1.11-4.298c2.123-.799.832-2.484.89-3.832c.026-.617 2.452-.494 2.276-2.874c-.124-1.676-3.816-4.064-4.822-5.083c-.581-.588 1.184-2.197-.059-3.612c-1.697-1.934-1.965-5.299-2.992-7.181c0 0 .783-1.196.183-1.876c-5.176-5.859-24.491-5.321-29.427 3.302c-5.541 9.68-5.615 23.059 5.906 30.267C16.667 50.65 10.104 62 10.104 62h20.319c0-1.938-2.266-8.89 1.7-8.578c3.446.271 7.666.122 7.292-3.77c-.113-1.174-.246-2.231.574-3.204c.82-.972 2.007-2.706-1.511-3.816"
                            />
                            <path d="M43.129 40.805L62 43.277v-4.943z" />
                            <path
                                d="M58.46 57.081l2.024-4.281l-17.355-9.368z"
                            />
                            <path
                                d="M60.484 28.766l-2.024-4.282l-15.331 13.651z"
                            />
                        </svg>
                        <span x-text="event.extendedProps.speaker"></span>
                    </p>
                </template>

                <template x-if="event.extendedProps?.location">
                    <p class="flex items-center gap-2">
                        <!-- Location Icon -->
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-4 w-4 text-gray-500"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                        >
                            <path
                                d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7Zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5S10.62 6.5 12 6.5s2.5 1.12 2.5 2.5S13.38 11.5 12 11.5Z"
                            />
                        </svg>
                        <template x-if="event.extendedProps.location_url">
                            <a
                                :href="event.extendedProps.location_url"
                                class="text-blue-600 hover:underline"
                                target="_blank"
                                x-text="event.extendedProps.location"
                            ></a>
                        </template>
                        <template x-if="!event.extendedProps.location_url">
                            <span x-text="event.extendedProps.location"></span>
                        </template>
                    </p>
                </template>
            </div>
        </div>

        <!-- Format Helpers -->
        <script>
            function formatDayDate(dateStr) {
                if (!dateStr) return "";
                const date = new Date(dateStr);
                return date.toLocaleDateString("en-SG", {
                    weekday: "short",
                    day: "2-digit",
                    month: "short",
                    year: "numeric",
                });
            }

            function formatTime(timeStr) {
                if (!timeStr || !timeStr.includes(":")) return "";
                const [hour, minute] = timeStr.split(":").map(Number);
                const date = new Date();
                date.setHours(hour, minute);
                return date.toLocaleTimeString("en-SG", {
                    hour: "numeric",
                    minute: "2-digit",
                    hour12: true,
                });
            }

            document.addEventListener("alpine:init", () => {
                Alpine.magic("formatDayDate", () => formatDayDate);
                Alpine.magic("formatTime", () => formatTime);
            });
        </script>
    </div>
{{ /partial:page_builder/block }}
