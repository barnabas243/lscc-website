<div x-data="scrollingHeader()" x-init="init()" x-ref="wrapper">
    <header
        x-ref="header"
        x-bind:style="`top: ${top}px`"
        class="will-change-top fixed left-0 z-50 w-full bg-neutral-950 text-white transition-none"
    >
        <div class="span-content flex items-center justify-between px-6 py-3">
            {{ partial:components/logo class="w-40 lg:w-50" }}
            {{ partial:navigation/main }}
        </div>
    </header>

    <!-- Spacer inside the same x-data scope -->
    <div x-ref="spacer"></div>
</div>

<script>
    function scrollingHeader() {
        return {
            top: 0,
            maxTop: 0,
            lastScrollY: window.scrollY,

            init() {
                const headerEl = this.$refs.header;
                const spacerEl = this.$refs.spacer;
                const headerHeight = headerEl.offsetHeight;

                this.maxTop = -headerHeight;
                spacerEl.style.height = `${headerHeight}px`;

                window.addEventListener("scroll", () => {
                    requestAnimationFrame(this.handleScroll.bind(this));
                });

                window.addEventListener("resize", () => {
                    const newHeight = headerEl.offsetHeight;
                    this.maxTop = -newHeight;
                    spacerEl.style.height = `${newHeight}px`;
                });
            },

            handleScroll() {
                const current = window.scrollY;
                const delta = current - this.lastScrollY;

                if (current <= 0) {
                    this.top = 0;
                } else if (delta > 0) {
                    this.top = Math.max(this.top - delta, this.maxTop);
                } else if (delta < 0) {
                    this.top = Math.min(this.top - delta, 0);
                }

                this.lastScrollY = current;
            },
        };
    }
</script>
